{"version":3,"file":"MyTestimonials.stories.7c968503.js","sources":["../../../src/features/testimonials/MyTestimonials.machine.js","../../../src/features/testimonials/MyTestimonials.jsx"],"sourcesContent":["import { createMachine, assign } from \"xstate\";\nimport { useMachine } from \"@xstate/react\";\nimport { useMemo } from \"react\";\n\n/** @xstate-layout N4IgpgJg5mDOIC5QFkCeACALnTBLAtgPYB2uAhgDawB0AMoWRLsVAMQQljXMBuhA1lwBmYTAGMAFgFowPMACdUmCcyiJQAB0KxceEupAAPRAEYADAHZqADgCcJ2wGZrZ6yYCsj9xYBsAGhBUREcTE2oAJgsAFh8zcJiLDwtfAF8UgLQsHAIScipqACUwRlRqAEkICjBWAGEJMhYwLHkyMX50WDAqsT1iAy0dXoNjBHMLd2oo20jwxzMnM0cLAKDRnysouJMor28oixcLNIyMbFg8IlJKGiKS8srquoaYdEJ5CAVVfu1dXH0kIyIdz2ahecIuEzrNybKIrUzrSZbHY+cHhDzuY4gTJnC65a6FYoQUoVKq1eqNdAaMgwb6DP59AEjCxo6i2CFmEx2dzcjxwhAhML2ExeHy2bwo6zhTHY7KXPI3QnEh5k55NMCGBRiXCdDrFeSSWm-f6gEbWaLUaLzHxeCxs+awwLBUKs0JeKLbbzucIY9JY06yvH5W5EugMJgsdicbjEPiCagicTSHE5K5UQ1DRmmYVRCKQnbWSXWKY+ax8-a2ajW6buFzc6zrNK+4iED7wAEy84p+WhxhfAEDI0Mk2IKLhPm2Mysif2cK2Nkmb2j6X+zty-HBpVVdP04aIayOCvhb2WCz28KLfyO0a2HMFmvTZKjuyc5dZVeBhV3ei9ljb42AhBRWsSY5n3KICwXMwfEvVYom5ahtjMbw2W8bNrFfZM1yDRU-yHAD3ARMEIShRCHVWG9JlCSJ3A5ZwCK8DCA1TNtNB+DNh1GUsr05agzD4swokE9w4MWRIfTSIA */\nconst machine = createMachine(\n  {\n    context: {\n      parameters: {\n        page: null,\n        track: null,\n        order: \"newest_first\",\n        exercise: \"\",\n      },\n      testimonials: null,\n      tracks: null,\n    },\n    initial: \"Loading\",\n    states: {\n      Loading: {\n        invoke: {\n          src: \"fetchEverything\",\n          id: \"fetch-everything\",\n          onDone: [\n            {\n              actions: \"updateTracksAndTestimonials\",\n              target: \"Ready\",\n            },\n          ],\n        },\n        type: \"parallel\",\n      },\n      Ready: {\n        initial: \"Idle\",\n        states: {\n          Idle: {\n            on: {\n              \"Change track selection\": {\n                actions: [\"updateSelectedTrack\", \"resetPage\"],\n                target: \"Loading\",\n              },\n              \"Change ordering\": {\n                actions: [\"updateOrder\", \"resetPage\"],\n                target: \"Loading\",\n              },\n              \"Change page\": {\n                actions: \"updatePage\",\n                target: \"Loading\",\n              },\n              \"Change exercise search\": {\n                actions: [\"updateExercise\", \"resetPage\"],\n                target: \"Loading\",\n              },\n            },\n          },\n          Loading: {\n            invoke: {\n              src: \"fetchTestimonialsOnly\",\n              id: \"fetch-testimonials\",\n              onDone: [\n                {\n                  actions: \"updateTestimonials\",\n                  target: \"#My testimonials.Ready\",\n                },\n              ],\n            },\n          },\n        },\n      },\n    },\n    id: \"My testimonials\",\n  },\n  {\n    services: { fetchTestimonialsOnly, fetchEverything },\n    actions: {\n      updateTestimonials: assign({\n        testimonials: (_, event) => event.data.testimonials,\n      }),\n      updateTracksAndTestimonials: assign({\n        tracks: (_, event) => event.data.tracks,\n        testimonials: (_, event) => event.data.testimonials,\n      }),\n      updateSelectedTrack: assign({\n        parameters: ({ parameters }, { track }) => ({ ...parameters, track }),\n      }),\n      updateExercise: assign({\n        parameters: ({ parameters }, { exercise }) => ({\n          ...parameters,\n          exercise,\n        }),\n      }),\n      updateOrder: assign({\n        parameters: ({ parameters }, { order }) => ({ ...parameters, order }),\n      }),\n      updatePage: assign({\n        parameters: ({ parameters }, { page }) => ({ ...parameters, page }),\n      }),\n      resetPage: assign({\n        parameters: ({ parameters }) => ({ ...parameters, page: null }),\n      }),\n    },\n  }\n);\n\nfunction fetchTestimonials({ parameters }) {\n  const url = new URL(\"https://exercism.org/api/v2/hiring/testimonials\");\n  for (const [key, value] of Object.entries(parameters)) {\n    if (value) url.searchParams.set(key, value);\n  }\n  return fetch(url).then((res) => res.json());\n}\n\nfunction fetchTracks() {\n  return fetch(\"https://exercism.org/api/v2/tracks\")\n    .then((res) => res.json())\n    .then(tracksMap);\n}\n\nfunction fetchEverything(context) {\n  return Promise.all([fetchTracks(), fetchTestimonials(context)])\n    .then(([tracks, testimonials]) => ({ tracks, ...testimonials }))\n    .then(populateTrackData);\n}\n\nfunction fetchTestimonialsOnly(context) {\n  return fetchTestimonials(context)\n    .then((testimonials) => ({ tracks: context.tracks, ...testimonials }))\n    .then(populateTrackData);\n}\n\nfunction populateTrackData({ tracks, testimonials }) {\n  testimonials.total = 0;\n  testimonials.tracks.forEach((track, index) => {\n    testimonials.tracks[index] = tracks.get(track);\n    testimonials.tracks[index].count = testimonials.track_counts[track] || 0;\n    testimonials.total += testimonials.track_counts[track];\n  });\n  return { tracks, testimonials };\n}\n\nfunction tracksMap(json) {\n  return new Map(json.tracks.map((track) => [track.slug, track]));\n}\n\nexport default function useTestimonalsMachine() {\n  const [state, send] = useMachine(machine);\n\n  const events = useMemo(\n    () => ({\n      onPageChange: (page) => send(\"Change page\", { page }),\n      onTrackChange: (track) => send(\"Change track selection\", { track }),\n      onExerciseChange: (exercise) =>\n        send(\"Change exercise search\", { exercise }),\n      onOrderChange: (order) => send(\"Change ordering\", { order }),\n    }),\n    [send]\n  );\n\n  return [state, events];\n}\n","import List from \"./list\";\nimport { Pill, Loading } from \"/src/components\";\nimport useTestimonialsMachine from \"./MyTestimonials.machine.js\";\nimport \"./MyTestimonials.css\";\n\nexport default function MyTestimonials() {\n  const [state, events] = useTestimonialsMachine();\n\n  if (state.matches(\"Loading\"))\n    return (\n      <div className=\"Loading-scope\">\n        <Loading />\n      </div>\n    );\n\n  return (\n    <main className=\"MyTestimonials page\">\n      <header>\n        <h1>Testimonials I&apos;ve left</h1>\n        <Pill value={state.context.testimonials?.total || \"?\"} />\n      </header>\n      <List\n        testimonials={state.context.testimonials.results}\n        currentPage={state.context.testimonials.pagination.current_page}\n        pageCount={state.context.testimonials.pagination.total_pages}\n        onPageChange={events.onPageChange}\n        tracks={state.context.testimonials.tracks}\n        onTrackChange={events.onTrackChange}\n        selectedTrack={state.context.parameters.track}\n        exercise={state.context.parameters.exercise}\n        onExerciseChange={events.onExerciseChange}\n        order={state.context.parameters.order}\n        onOrderChange={events.onOrderChange}\n        loading={state.matches(\"Ready.Loading\")}\n      />\n    </main>\n  );\n}\n"],"names":["useMemo","state","events","useTestimonialsMachine","matches","_jsx","_jsxs","context","testimonials","total","results","pagination","current_page","total_pages","onPageChange","tracks","onTrackChange","parameters","track","exercise","onExerciseChange","order","onOrderChange"],"mappings":"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"}